YUI.add("moodle-mod_registerattendance-changecompletionstate",function(e,t){M.mod_registerattendance=M.mod_registerattendance||{},M.mod_registerattendance.changecompletionstate={CSS:{},SELECTORS:{FILTER:"#mform-attendancelist-filter",TABLE:"#attendancelist",BUTTON:"button",CHECKBOX:"input[type=checkbox]",RADIO:"input[type=radio]",FILTERSUBMIT:"input[type=submit]",SHOWATTENDED:"#fgroup_id_showattendedarr",HAVEATTTENDED:".haveatttended",ATTTENDED:".attended",ENROLLED:".enrolled",BULKREGISTER:"#bulkregister",REGISTERLISTED:"#registerlisted",UNREGISTERLISTED:"#unregisterlisted"},table:null,ajaxurl:M.cfg.wwwroot+"/mod/registerattendance/ajax/changecompletionstate.php",init:function(){var t=null,n=null;this.table=e.one(this.SELECTORS.TABLE),this.table&&this.table.delegate("change",this.value_changed,this.SELECTORS.CHECKBOX,this),t=e.one(this.SELECTORS.SHOWATTENDED),t&&t.delegate("click",this.showattended_clicked,this.SELECTORS.RADIO,this),n=e.one(this.SELECTORS.BULKREGISTER),n&&n.delegate("click",this.bulkregister_clicked,this.SELECTORS.BUTTON,this)},value_changed:function(e){var t=e.target.getData("userid"),n=e.target.getData("cmid"),r=e.target.get("checked"),i={};t&&n&&(i={cmid:n,userid:t,state:r?1:0},this.performAjaxAction("changestate",i,this.value_changed_feedback,this))},value_changed_feedback:function(e,t,n){var r=this.checkAjaxResponse(e,t,n);r.error||this.value_changed_update_number(r.outcome.state,r.outcome.amount)},value_changed_update_number:function(t,n){var r=e.one(this.SELECTORS.HAVEATTTENDED).one(this.SELECTORS.ATTTENDED),i,s;r&&(i=parseInt(r.get("text"),10),t?r.set("text",i+n):i>0&&(s=i-n,s<0&&(s=0),r.set("text",s)))},showattended_clicked:function(){e.one(this.SELECTORS.FILTER).one(this.SELECTORS.FILTERSUBMIT).simulate("click")},bulkregister_clicked:function(e){var t=e.target.get("id"),n=null,r,i,s=[];this.table&&(n=this.table.all(this.SELECTORS.CHECKBOX)),n&&(r=parseInt(n.slice(0,1).getData("cmid"),10),"#"+t===this.SELECTORS.REGISTERLISTED?(i=!0,n.each(function(e){e.get("checked")||(e.set("checked",!0),s.push(e.getData("userid")))})):"#"+t===this.SELECTORS.UNREGISTERLISTED&&(i=!1,n.each(function(e){e.get("checked")&&(e.set("checked",!1),s.push(e.getData("userid")))})),args={cmid:r,userids:s,state:i?1:0},this.performAjaxAction("bulkchangestate",args,this.value_changed_feedback,this))},performAjaxAction:function(t,n,r,i){var s=new e.IO;n.action=t,n.ajax="1",n.sesskey=M.cfg.sesskey,r===null&&(r=function(){}),s.send(this.ajaxurl,{method:"POST",on:{complete:r},context:i,data:build_querystring(n),arguments:n})},checkAjaxResponse:function(t,n,r){if(n.status!==200)return!1;if(t===null||r===null)return!1;var i=e.JSON.parse(n.responseText);return i.error!==!1&&(new M.core.exception(i.error)).show(),i.outcome===!1?!1:i}}},"@VERSION@",{requires:["base","node","event","node-event-delegate","node-event-simulate","moodle-core-notification-exception"]});
