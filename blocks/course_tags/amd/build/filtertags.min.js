define(["jquery","core/log","theme_bootstrapbase/bootstrap"],function($,e){"use strict";e.debug("AMD block_course_tags/filtertags loaded");var n=null,t=null,i=null,a=null,o=null,l=null,c=function(e){e=e||o.find(".inplaceeditable"),r(e),s(e),f()},d=function(e){e=e||o.find(".inplaceeditable"),e.parent("li").removeClass("hidden")},r=function(e){e=e||o.find(".inplaceeditable"),e.parent("li").addClass("hidden")},s=function(e){e=e||o.find(".inplaceeditable"),e.each(function(){var e=$(this);1===e.data("value")&&e.parent("li").removeClass("hidden")})},u=function(e){var n=!1;return e.filter('[data-value="1"]').length&&(n=!0),n},f=function(){o.find(".accordion-body").each(function(){var e=$(this);e.has("li:not(.hidden)").length?e.collapse("show"):e.collapse("hide")})},h=function(e){var n=$.Deferred(function(n){e.one("hidden.bs.collapse",function(){n.resolve()})});return e.collapse("hide"),n.promise()},p=function(e){e.preventDefault()},g=function(){var e=null,n="",t=null,i=null;e=a,n=e.val().toLowerCase(),""!==n?(t=o.find(".unlist"),i=t.find("li"),i.each(function(){var e=$(this);-1!==e.data("tagname").toLowerCase().indexOf(n)?e.removeClass("hidden"):e.addClass("hidden")}),l.is(":checked")&&s(o.find(".inplaceeditable")),f()):l.is(":checked")?c():$.when(h(o.find(".accordion-body"))).done(function(){r(o.find(".inplaceeditable"))})},b=function(e){var n=$(e.target),t=n.parents(".accordion-group").find(n.attr("href")),i=t.find(".inplaceeditable");e.stopPropagation(),e.preventDefault(),t.hasClass("in")?t.has("li.hidden").length?$.when(h(t)).done(function(){d(i),t.collapse("show")}):l.is(":checked")&&u(t.find(".inplaceeditable"))?$.when(h(t)).done(function(){r(i),s(i),t.collapse("show")}):$.when(h(t)).done(function(){r(i)}):(d(i),t.collapse("show"))},v=function(e){var n=$(e.target);"show"===e.type||e.type},w=function(e){var n=$(e.target);"shown"===e.type||e.type},k=function(e){e.each(function(){var e=$(this).get(0);console.log("initMutationObserver",e);var n=new MutationObserver(function(e){e.forEach(function(e){"style"===e.attributeName&&console.log($(e.target).clone())})}),t={attributes:!0,childList:!1,characterData:!1};n.observe(e,t)})};return{init:function(){var d=null;e.debug("AMD block_course_tags/filtertags init"),i=$("#tag-filter-form"),a=$("#tag-filter"),o=$("#taggroup-accordion"),n=o.find(".collapse"),t=o.find(".accordion-toggle"),l=$("#showalsoselected-checkbox"),i.on("submit",p),i.on("keyup","#tag-filter",g),l.on("change",g),t.on("click",b),n.collapse({toggle:!1}),l.is(":checked")&&c()}}});