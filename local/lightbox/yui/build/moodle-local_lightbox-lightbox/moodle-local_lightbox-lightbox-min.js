YUI.add("moodle-local_lightbox-lightbox",function(e,t){var n="Lightbox",r="moodle-local_lightbox-lightbox",i={MOODLEDIALOGBASE:".moodle-dialogue-base",MOODLEDIALOGCLASS:"moodle-dialogue",MOODLEDIALOGWRAPCLASS:"moodle-dialogue-wrap",MOODLEDIALOGHDCLASS:"moodle-dialogue-hd"},s={MDLBODY:"body",MDLPAGE:"#page-content",MDLCUSTOMMENU:".navbar-fixed-top",EXTLINKS:'a[rel="lightbox"]',EXTURL:".urlworkaround a",IFRAME:"#external-links"},o={LBPADDINGBOTTOM:5,LBIFRAMEGBOTTOM:7,MINWINDOWWIDTH:960,MINWINDOWHEIGHT:800},u=e.namespace("Moodle.local_lightbox"),a;u[n]=e.Base.create(r,e.Panel,[],{theframe:null,firstload:!0,clickdelegate:[],clickoutside:null,hasbeenshown:!1,initializer:function(){var t=this,n=e.one(s.MDLPAGE);this.clickdelegate.push(n.delegate("click",function(e){e.preventDefault(),e.stopPropagation(),t.handleExtLinkClick(e.currentTarget)},s.EXTLINKS)),this.clickdelegate.push(n.delegate("click",function(e){e.preventDefault(),e.stopPropagation(),t.handleURLLinkClick(e.currentTarget)},s.EXTURL)),n.all(s.EXTURL).each(function(e){var t=e.getAttribute("onclick");if(t!==""){var n=t.match(/width=(\d*)/),r=t.match(/height=(\d*)/),i,s;i=n!==null?n[1]:0,s=r!==null?r[1]:0,e.setAttribute("data-width",""+i),e.setAttribute("data-height",""+s),e.setAttribute("onclick","")}})},destructor:function(){this.set("bodyContent",""),this.get("contentBox").detach("clickoutside"),this.clickdelegate.forEach(function(e){console.log(e),e.detach()})},display:function(){this.show(),this.get("maskNode").setStyle("opacity",.8),this.resizeBody(),this.centerDialogue(),this.clickoutside=this.get("contentBox").on("clickoutside",this.handleClickoutside,this),this.get("buttons").header[0].focus()},hideLightBox:function(){this.hide(),this.set("src",""),this.clickoutside.detach()},handleVisibleChange:function(){this.get("visible")||this.hideLightBox()},handleClickoutside:function(){this.hideLightBox()},handleExtLinkClick:function(e){var t=e.getAttribute("href");t.indexOf("scorm")!==-1&&(t=t.replace("mod/scorm","local/scorm_lightbox")),t!==""&&(this.set("src",t),this.display())},handleURLLinkClick:function(e){var t=e.getAttribute("href"),n=e.getAttribute("data-width"),r=e.getAttribute("data-height");t!==""&&(this.set("src",t),n&&r&&(this.set("width",n),this.set("height",parseInt(r,10)+20)),this.display())},handleIFrameLoaded:function(){if(this.firstload){this.firstload=!1;return}this.get("frameloaded")&&this.display()},handleResizeChange:function(){this.resizeBody(),this.centerDialogue()},centerDialogue:function(){var e=this.get("boundingBox"),t=parseInt(e.getComputedStyle("width"),10),n=parseInt(e.getComputedStyle("height"),10),r=e.get("winWidth"),i=e.get("winHeight");this.set("xy",[(r-t)/2,(i-n)/2])},resizeBody:function(){var t=this.get("contentBox"),n=this.getStdModNode(e.WidgetStdMod.HEADER),r=this.getStdModNode(e.WidgetStdMod.BODY),i;i=t.get("clientHeight")-n.get("clientHeight"),this.theframe.setStyle("height",i-o.LBPADDINGBOTTOM+"px"),r.setStyle("height",i-o.LBIFRAMEGBOTTOM+"px")},renderUI:function(){this.set("bodyContent",'<iframe id="external-links"/>'),this.set("headerContent",""),this.theframe=this.get("contentBox").one(s.IFRAME),this.get("boundingBox").addClass(i.MOODLEDIALOGCLASS),this.get("contentBox").addClass(i.MOODLEDIALOGWRAPCLASS),this.plug(e.Plugin.Drag,{handles:[".yui3-moodle-local_lightbox-lightbox .moodle-dialogue-hd"]}),this.getStdModNode(e.WidgetStdMod.HEADER,!0).addClass(i.MOODLEDIALOGHDCLASS)},bindUI:function(){var t=this;e.on("windowresize",function(){t.set("resized",e.one("window").get("winHeight"))}),this.after("resizedChange",this.handleResizeChange,this),this.after("visibleChange",this.handleVisibleChange,this),this.after("srcChange",this.syncUI,this)},syncUI:function(){this.theframe.setAttribute("src",this.get("src"))}},{ATTRS:{param1:{value:"Test plugin default text"},src:{value:""},frameloaded:{value:!1},resized:{value:0},modal:{value:!0},visible:{value:!1},height:{value:"80%"},width:{value:"90%"},zIndex:{value:5e3}}}),window.M=window.M||{},M.local_lightbox=M.local_lightbox||{},a=M.local_lightbox.lightbox={},a.init_lightbox=function(t){var r,a,f;console.log("init_lightbox"),window.getComputedStyle!==undefined?f=window.getComputedStyle(document.body,":after").getPropertyValue("content"):f=e.one("body").get("offsetWidth")>=o.MINWINDOWWIDTH?"widescreen":"";if(f.indexOf("widescreen")!==-1){if(!e.one(s.EXTLINKS))return;r=e.one(i.MOODLEDIALOGBASE),r||(r=e.Node.create('<div class="moodle-dialogue-base"></div>'),e.one(s.MDLBODY).append(r)),YUI().use("event-resize"),a=new u[n](t),window.screen.height<=o.MINWINDOWHEIGHT&&a.set("height","97%"),a.render(r)}}},"0.1.0",{requires:["panel","dd-plugin","node","event-resize"],config:{use:["panel","dd-plugin","node","event-resize"]}});
