YUI.add("moodle-local_lightbox-lightbox",function(e,t){var n="Lightbox",r="moodle-local_lightbox-lightbox",i={MOODLEDIALOGBASE:".moodle-dialogue-base",MOODLEDIALOGCLASS:"moodle-dialogue",MOODLEDIALOGWRAPCLASS:"moodle-dialogue-wrap",MOODLEDIALOGHDCLASS:"moodle-dialogue-hd",INLIGHTBOX:"in-lightbox",NOLIGHTBOX:"no-lightbox"},s={MDLBODY:"body",MDLPAGE:"#page-content",MDLCUSTOMMENU:".navbar-fixed-top",IFRAME:"#external-links"},o={EXTLINKS:{link:'a[rel="lightbox"]',method:"handleExtLinkClick"},SCORMLINKS:{link:"a.scorm",method:"handleSCORMLinkClick"},EXTURL:{link:".urlworkaround a",method:"handleURLLinkClick"},EXTURLLIGHTBOX:{link:".urlworkaround a.in-lightbox",method:"handleURLLinkClick"}},u={LBPADDINGBOTTOM:5,LBIFRAMEGBOTTOM:7,MINWINDOWWIDTH:920,MINWINDOWHEIGHT:800},a=e.namespace("Moodle.local_lightbox"),f;a[n]=e.Base.create(r,e.Panel,[],{theframe:null,firstload:!0,clickdelegate:[],clickoutside:null,hasbeenshown:!1,lectorafw:null,initializer:function(){var t,n=e.one(s.MDLPAGE);f.initialized=!0;for(t in o)t==="EXTURL"?this.check_https(o[t]):this.addClickDelegate(o[t]);n.all(o.EXTURL.link).each(function(e){if(e.hasClass(i.INLIGHTBOX)){var t=e.getAttribute("onclick");if(t!==""){var n=t.match(/width=(\d*)/),r=t.match(/height=(\d*)/),s,o;s=n!==null?n[1]:0,o=r!==null?r[1]:0,e.setAttribute("data-width",""+s),e.setAttribute("data-height",""+o),e.setAttribute("onclick","")}}})},destructor:function(){this.set("bodyContent",""),this.get("contentBox").detach("clickoutside"),this.clickdelegate.forEach(function(e){e.detach()})},display:function(){this.show(),this.get("maskNode").setStyle("opacity",.8),this.resizeBody(),this.centerDialogue(),this.clickoutside=this.get("contentBox").on("clickoutside",this.handleClickoutside,this),this.get("buttons").header[0].focus()},hideLightBox:function(){var t=this.get("contentBox").one("#external-links").getDOMNode(),n=t.contentDocument,r=e.one(n).one("#scorm_object"),i=null;if(r){var s=r.getDOMNode().contentDocument;if(s.all.length&&s.all[0].innerHTML.indexOf("GENERATED BY:  Lectora")!==-1){var o=s.getElementsByName("contentframe")[0];if(o){i=o.contentWindow;if(i){var u=e.one(i);u.on("unload",function(){}),u.on("beforeunload",function(){}),"finish"in i&&i.is.webkit&&(i.onbeforeunload=null,i.onunload=i.finish),"doQuit"in i?(i.doQuit_orig=i.doQuit,i.doQuit=function(t){t=0,i.doQuit_orig(t)}):i.finishCalled!==!0&&("computeTime"in i&&i.computeTime(),"LMSCommit"in i&&i.LMSCommit())}}}}this.set("src",""),this.clickoutside.detach()},handleVisibleChange:function(){this.get("visible")||this.hideLightBox()},handleClickoutside:function(){this.hide()},addClickDelegate:function(t){var n=this,r=e.one(s.MDLPAGE);this.clickdelegate.push(r.delegate("click",function(e){e.preventDefault(),e.stopPropagation(),n[t.method].call(n,e.currentTarget)},t.link))},check_https:function(t){var n=e.one(s.MDLPAGE),r=n.all(t.link);r&&r.each(function(e){var t=e.getAttribute("href");t.indexOf("https")!==-1?e.addClass(i.INLIGHTBOX):e.addClass(i.NOLIGHTBOX)})},handleExtLinkClick:function(e){var t=e.getAttribute("href");t.indexOf("scorm")!==-1&&(t=t.replace("mod/scorm","local/scorm_lightbox")),t!==""&&(this.set("src",t),this.display())},handleSCORMLinkClick:function(e){var t=e.getAttribute("href"),n=e.getAttribute("data-scormwidth"),r=e.getAttribute("data-scormheight");t.indexOf("/mod/scorm/")!==-1&&(t=t.replace("/mod/scorm/","/local/scorm_lightbox/")),console.log(t,n,r),t!==""&&(this.set("src",t),n&&r&&(this.set("width",n),this.set("height",parseInt(r,10)+20)),this.display())},handleURLLinkClick:function(e){var t=e.getAttribute("href"),n=e.getAttribute("data-width"),r=e.getAttribute("data-height");t!==""&&(this.set("src",t),n&&r&&(this.set("width",n),this.set("height",parseInt(r,10)+20)),this.display())},handleIFrameLoaded:function(){if(this.firstload){this.firstload=!1;return}this.get("frameloaded")&&this.display()},handleResizeChange:function(){this.resizeBody(),this.centerDialogue()},centerDialogue:function(){var e=this.get("boundingBox"),t=parseInt(e.getComputedStyle("width"),10),n=parseInt(e.getComputedStyle("height"),10),r=e.get("winWidth"),i=e.get("winHeight");this.set("xy",[(r-t)/2,(i-n)/2])},resizeBody:function(){var t=this.get("contentBox"),n=this.getStdModNode(e.WidgetStdMod.HEADER),r=this.getStdModNode(e.WidgetStdMod.BODY),i;i=t.get("clientHeight")-n.get("clientHeight"),this.theframe.setStyle("height",i-u.LBPADDINGBOTTOM+"px"),r.setStyle("height",i-u.LBIFRAMEGBOTTOM+"px")},renderUI:function(){this.set("bodyContent",'<iframe id="external-links"></iframe>'),this.set("headerContent",""),this.theframe=this.get("contentBox").one(s.IFRAME),this.get("boundingBox").addClass(i.MOODLEDIALOGCLASS),this.get("contentBox").addClass(i.MOODLEDIALOGWRAPCLASS),e.UA.ie?e.one(".yui3-moodle-local_lightbox-lightbox .yui3-widget-hd").setStyle("cursor","default"):this.plug(e.Plugin.Drag,{handles:[".yui3-widget-hd"]}),this.getStdModNode(e.WidgetStdMod.HEADER,!0).addClass(i.MOODLEDIALOGHDCLASS)},bindUI:function(){var t=this;e.on("windowresize",function(){t.set("resized",e.one("window").get("winHeight"))}),this.after("resizedChange",this.handleResizeChange,this),this.after("visibleChange",this.handleVisibleChange,this),this.after("srcChange",this.syncUI,this)},syncUI:function(){this.theframe.setAttribute("src",this.get("src"))}},{ATTRS:{src:{value:""},frameloaded:{value:!1},resized:{value:0},modal:{value:!0},visible:{value:!1},height:{value:"80%"},width:{value:"90%"},zIndex:{value:5e3}}}),window.M=window.M||{},M.local_lightbox=M.local_lightbox||{},f=M.local_lightbox.lightbox={},f.initialized=!1,f.init_lightbox=function(t){var r,l,c;if(f.initialized)return;window.getComputedStyle!==undefined?c=window.getComputedStyle(document.body,":after").getPropertyValue("content"):c=e.one("body").get("offsetWidth")>=u.MINWINDOWWIDTH?"widescreen":"";if(c.indexOf("widescreen")!==-1){var h=!0,p;for(p in o)if(e.one(o[p].link)){h=!1;break}if(h)return;r=e.one(i.MOODLEDIALOGBASE),r||(r=e.Node.create('<div class="moodle-dialogue-base"></div>')
,e.one(s.MDLBODY).append(r)),YUI().use("event-resize"),l=new a[n](t),window.screen.height<=u.MINWINDOWHEIGHT&&l.set("height","97%"),l.render(r)}}},"0.1.0",{requires:["panel","node","dd-plugin","dd-drag","event-resize"],config:{use:["panel","node","dd-plugin","dd-drag","event-resize"]}});
