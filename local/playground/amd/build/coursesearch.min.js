define(["jquery","core/notification","core/log","core/ajax","core/templates","theme_bootstrapbase/bootstrap"],function($,e,n,t,a){"use strict";n.debug("AMD module loaded.");var o=[],r=[],c=null,i=null,u=null,s=null,d=null,l=null,f="hide-item",h={group:null,name:null,addtext:null,remove:0},g=function(e){var n=e.tags.groups,t;n.length&&(n.forEach(function(e){t=$.grep(e.shown,function(e){return 1===e.checked}),t.length&&(o=$.merge(o,t))}),p({selectedTags:o}))},p=function(e){a.render("local_playground/course_search_selected_tags",e).done(function(e){s.append(e),d=s.find(".selected-tags")})},m=function(e){a.render("local_playground/course_search_region_tags",e).done(function(e){u.after(e)})},v=function(e){a.render("local_playground/course_search_results",e).done(function(e){l.append(e)})},_=function(){var e=$(this),n=e.is(":checked"),t=null,o=$.extend({},h,{group:e.parent().data("group"),name:e.parent().data("name")});n?a.render("local_playground/course_search_selected_tags_item",o).done(function(e){d.append(e)}):(t=s.find("button").filter('[data-name="'+e.parent().data("name")+'"]').parent("li").remove(),o.remove=1),k()},x=function(){var e=$(this);"searchquery"===e.data("group")?i.find(".search-query").val(""):c.find("label").filter('[data-name="'+e.data("name")+'"]').find("input").prop("checked",!1),e.remove(),k()},b=function(e){var n=$(this),t,o;e.preventDefault(),t=n.find(".search-query").val(),o=$.extend({},h,{group:"searchquery",name:t,addtext:"Search text: "}),s.find("li").has('[data-group="searchquery"]').remove(),""!==t&&a.render("local_playground/course_search_selected_tags_item",o).done(function(e){d.append(e)}),k()},y=function(){return i.find("#course-search").val().toLowerCase()},C=function(){var e,n=[];return e=i.find("label").has(":checked"),e.each(function(){var e=$(this);n.push(e.data("group")+"-"+e.data("name"))}),n},k=function(){var e=C(),n=y(),t=""!==n,a=[],o,c,i,u,s,d;for(o=t?e.length+1:e.length,i=0,u=r.length;i<u;i++){for(c=0,t&&r[i].textcollection.indexOf(n)!==-1&&c++,s=0,d=e.length;s<d;s++)r[i].tagcollection.indexOf(e[s])!==-1&&c++;c===o&&a.push(r[i].id)}!a.length&&e.length&&a.push(-1),q(a)},q=function(e){var n=l.find(".course-cards"),t=l.find(".course-list");e.length?e[0]===-1?r.forEach(function(e){n.find("#coursecarditem-"+e.id).addClass(f),t.find("#courselistitem-"+e.id).addClass(f)}):r.forEach(function(a){e.indexOf(a.id)!==-1?(n.find("#coursecarditem-"+a.id).removeClass(f),t.find("#courselistitem-"+a.id).removeClass(f)):(n.find("#coursecarditem-"+a.id).addClass(f),t.find("#courselistitem-"+a.id).addClass(f))}):r.forEach(function(e){n.find("#coursecarditem-"+e.id).removeClass(f),t.find("#courselistitem-"+e.id).removeClass(f)})},w=function(e){var n=[],t=[],a=[];return $.each(e,function(e,o){n=[],t=[],a.push(o.id),$.each(o.tags,function(e,a){t.push(a.group+"-"+a.name),n.push(a.name)}),o.tagcollection=t,o.textcollection=n.join(","),o.textcollection+=" "+o.name+" "+o.summary,o.textcollection=o.textcollection.toLowerCase()}),e.courseids=a,e};return{init:function(){n.debug("AMD module init."),c=$("#search-area"),i=$("#course-search-form"),s=$("#tag-area"),l=$("#result-area"),u=c.find(".form-search"),$.getJSON("./course_search.json",function(e){n.debug(e),g(e),m(e)}).fail(e.exception),$.getJSON("./courses.json",function(e){n.debug(e),r=w(e.courses),e.baseurl=M.cfg.wwwroot,v(e)}).fail(e.exception),c.on("click",'[type="checkbox"]',_),s.on("click","button",x),i.on("submit",b)}}});